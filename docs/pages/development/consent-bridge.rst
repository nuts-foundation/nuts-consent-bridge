.. _nuts-consent-bridge-development:

Nuts consent bridge development
###############################

.. marker-for-readme

The consent bridge is written in Kotlin and can be build by Gradle.

Dependencies
************

Since the bridge depends on Corda, Java 1.8 is needed. For the Oracle sdk, this means that your version needs to be > 1.8 update 151.
This can give problems on several linux distro's. In that case use the latest OpenJDK 1.8.

The project is build with Gradle. A gradle wrapper is present in the project.

Generating code
***************

Api stubs are generated by running

.. code-block:: shell

    ./gradlew codegen

Running tests
*************

Tests can be run by executing

.. code-block:: shell

    ./gradlew test

Building
********

Executable can be build by executing

.. code-block:: shell

    ./gradlew bootJar

Docker
******

To build locally

.. code-block:: shell

    docker build . -f docker/Dockerfile-dev

The ``nutsfoundation/nuts-consent-bridge:latest-dev`` docker image can be used to connect to one of the 2 consent nodes locally. It's important to mount the different files from ``docker/nodes/x``

.. code-block:: shell

    docker run -it -p 8080:8080 \
        --network=nuts
        -v /home/user/nuts-consent-bridge/docker/nodes/dahmer/application.properties:/opt/nuts/application.properties
        --rm
        nutsfoundation/nuts-consent-bridge:latest-dev

The ports need to be changed if already in use. Port ``8080`` is the port for API calls. Check :ref:`nuts-consent-bridge-api` for the calls that can be made.

This image requires the ``nutsfoundation/nuts-consent-cordapp`` image to be running in a container exposed at ``dahmer:7886`` and/or ``bundy:7886``.

If you haven't created a docker network yet, create one to to able to connect the containers together:

.. code-block:: shell

    docker network create -d bridge nuts

TODO: EXAMPLE consent between dahmer/bundy for 999999990

README
******

The readme is auto-generated from a template and uses the documentation to fill in the blanks.

.. code-block:: shell

    ./generate_readme.sh

Documentation
*************

To generate the documentation, you'll need python3, sphinx and a bunch of other stuff. See :ref:`nuts-documentation-development-documentation`
The documentation can be build by running

.. code-block:: shell

    /docs $ make html

The resulting html will be available from ``docs/_build/html/index.html``

